services:
  yt-api-mock:
    image: ghcr.io/yuge42/yt-api-mock/server:dev-b7d5b30
    ports:
      - "50051:50051"
      - "8080:8080"
    environment:
      - LOG_LEVEL=info
      - TLS_CERT_PATH=/certs/server-cert.pem
      - TLS_KEY_PATH=/certs/server-key.pem
    volumes:
      - ./certs:/certs:ro
    networks:
      - yt-fetcher

  fetcher:
    build:
      context: .
      dockerfile: Dockerfile
    depends_on:
      - yt-api-mock
    environment:
      - SERVER_ADDRESS=https://yt-api-mock:50051
      - REST_API_ADDRESS=https://yt-api-mock:8080
    networks:
      - yt-fetcher
    # Command will be provided when running docker compose
    # Example: docker compose run --rm fetcher --video-id test-video-1

networks:
  yt-fetcher:
    driver: bridge
